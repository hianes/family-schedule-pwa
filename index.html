<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì‹œê°„í‘œ - ì‹¤ì‹œê°„ ë™ê¸°í™”</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ìš°ë¦¬ ê°€ì¡±ì˜ ì‹œê°„í‘œ - Google Sheetsì™€ ì‹¤ì‹œê°„ ë™ê¸°í™”, 4ë“±ë¶„ ê³ ì • ë ˆì´ì•„ì›ƒ">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ê°€ì¡±ì‹œê°„í‘œ">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Favicon & App Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzIxOTZGMyIvPgo8cGF0aCBkPSJNOCAzaDJWMWgydjJoNFYxaDJ2Mmg0VjFoMnYyaDJjMS4xIDAgMi45IDIgLjkgMkwyNCAxM3Y3YzAgMS4xLS45IDItMiAySDEwYy0xLjEgMC0yLS45LTItMlYxM2MwLTEuMS45LTItMi0yem0wIDEySDEwdjhoMTJWMTN6IiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iMjAiIGZpbGw9IiMyMTk2RjMiLz4KPHN2ZyB4PSI0NSIgeT0iNDUiIHdpZHRoPSI5MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xOSAzaC0xVjFoLTJ2Mkg4VjFINnYySDVjLTEuMTEgMC0xLjk5Ljg5LTEuOTkgMkwzIDVWMTljMCAxLjEuODkgMiAyIDJoMTRjMS4xIDAgMi0uOSAyLTJWNWMwLTEuMTEtLjg5LTItMi0yem0wIDE2SDVWOGgxNHYxMXoiLz4KPC9zdmc+Cjwvc3ZnPg==">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding-top: 50px;
            background: #f8f9fa;
        }
        
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #2196f3;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .status-text {
            font-weight: 500;
        }
        
        .refresh-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .status-success { color: #4caf50; }
        .status-error { color: #f44336; }
        .status-warning { color: #ff9800; }
        
        .container {
            margin: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .week-info {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .week-navigation {
            display: flex !important; /* ê°•ì œ í‘œì‹œ */
            gap: 10px;
            align-items: center;
            visibility: visible !important; /* ê°•ì œ í‘œì‹œ */
            opacity: 1 !important; /* ê°•ì œ í‘œì‹œ */
        }
        
        .week-nav-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .week-nav-btn:hover {
            background: #1976d2;
        }
        
        .week-nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .current-week {
            font-weight: bold;
            color: #2196f3;
        }
        
        .memo-guide {
            background: #e8f4fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .memo-guide h3 {
            margin: 0 0 15px 0;
            color: #1976d2;
            font-size: 16px;
        }
        
        .member-memo {
            margin-bottom: 10px;
            background: rgba(255,255,255,0.7);
            padding: 10px;
            border-radius: 6px;
        }
        
        .memo-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        
        .member-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        .memo-content {
            font-size: 12px;
            color: #555;
            padding-left: 28px;
            line-height: 1.6;
            word-break: break-word;
        }
        
        .timetable {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        
        th {
            background: #f1f3f4;
            padding: 8px 4px;
            font-weight: 600;
            text-align: center;
            border-bottom: 2px solid #e0e0e0;
            font-size: 12px;
        }
        
        .time-col {
            background: #fafafa;
            width: 70px;
            font-weight: 500;
            color: #666;
            text-align: center;
            font-size: 10px;
            padding: 2px;
        }
        
        td {
            padding: 0;
            border: 1px solid #e8e8e8;
            height: 20px;
            vertical-align: middle;
            position: relative;
        }
        
        .time-slot {
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .empty-slot {
            position: absolute;
            height: calc(100% - 1px);
            top: 0.5px;
        }
        
        .event-bar {
            position: absolute;
            height: calc(100% + 2px);
            top: -1px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 500;
            color: white;
            text-shadow: 0 1px 1px rgba(0,0,0,0.3);
            z-index: 20;
            overflow: hidden;
            white-space: nowrap;
            box-sizing: border-box;
        }
        
        .dad-bar { background: linear-gradient(135deg, #D6E3FF, #C2D2FF); color: black; }
        .mom-bar { background: linear-gradient(135deg, #FFD6ED, #FFC2E0); color: black; }
        .child1-bar { background: linear-gradient(135deg, #D6ECFF, #C2E0FF); color: black; }
        .child2-bar { background: linear-gradient(135deg, #E8F5D2, #D4E8B8); color: black; }
        
        .family-common {
            background: linear-gradient(135deg, #FFF3C4, #FFECB3) !important;
            color: black;
        }
        
        .multi-participant {
            background: linear-gradient(135deg, #FFE4B5, #FFDAB9) !important;
            color: black;
            border: 1px solid #FFB366;
        }
        
        .bar-start { 
            border-top-left-radius: 8px; 
            border-top-right-radius: 8px; 
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        .bar-middle { 
            border-radius: 0; 
        }
        .bar-end { 
            border-bottom-left-radius: 8px; 
            border-bottom-right-radius: 8px; 
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        .bar-single { 
            border-radius: 8px; 
        }
        
        .event-text,
        .large-text {
            display: block;
        }
        
        .large-text {
            display: flex !important;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .color-box {
            width: 20px;
            height: 12px;
            border-radius: 6px;
        }
        
        .hour-line {
            border-top: 2px solid #ddd;
        }
        
        .export-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 13px;
            color: #666;
            text-align: center;
        }
        
        .event-text {
            color: black !important;
            font-weight: 600;
            font-size: 9px;
            padding: 1px 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-shadow: 0 0 2px rgba(255,255,255,0.6);
        }
        
        .large-text {
            color: black !important;
            text-shadow: 0 0 3px rgba(255,255,255,0.8) !important;
            white-space: normal !important;
            text-align: center !important;
            line-height: 1.1 !important;
            font-weight: 700 !important;
            word-break: keep-all !important;
            overflow-wrap: break-word !important;
            padding: 1px 2px !important;
            overflow: visible !important;
            text-overflow: unset !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            height: 100% !important;
        }
        
        @media (max-width: 768px) {
            table { font-size: 9px; }
            td { height: 18px; }
            .event-bar { font-size: 8px; }
        }
        
        /* ğŸ“± PWA ì„¤ì¹˜ ì•Œë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* PWA ì„¤ì¹˜ ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        #install-btn:hover {
            background: rgba(255,255,255,0.3) !important;
            transform: scale(1.05);
            transition: all 0.2s ease;
        }
    </style>
    
    <!-- ğŸ” ê°€ì¡± ì „ìš© ì¸ì¦ ì‹œìŠ¤í…œ (ê°„ë‹¨ ë²„ì „) -->
    <script>
        // ğŸ”‘ ê°€ì¡± íŒ¨ìŠ¤ì›Œë“œ í™•ì¸
        (function() {
            const FAMILY_PASSWORD = 'kim2024family';
            const AUTH_KEY = 'familyScheduleAuth';
            
            // ì¸ì¦ ìƒíƒœ í™•ì¸
            if (localStorage.getItem(AUTH_KEY) !== 'verified') {
                // ğŸ” ì¸ì¦ í•„ìš”
                const password = prompt('ğŸ” ê¹€ì”¨ ê°€ì¡± ì‹œê°„í‘œ\n\nê°€ì¡± êµ¬ì„±ì›ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nì ‘ê·¼ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                
                if (password === FAMILY_PASSWORD) {
                    // âœ… ì¸ì¦ ì„±ê³µ
                    localStorage.setItem(AUTH_KEY, 'verified');
                    localStorage.setItem('familyAuthDate', new Date().toISOString());
                    alert('ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤! ê¹€ì”¨ ê°€ì¡± ì‹œê°„í‘œì…ë‹ˆë‹¤.\n\nğŸ’¡ í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ì—¬ ì•±ì²˜ëŸ¼ ì‚¬ìš©í•˜ì„¸ìš”!');
                } else {
                    // âŒ ì¸ì¦ ì‹¤íŒ¨
                    alert('âŒ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì ‘ê·¼ ì½”ë“œì…ë‹ˆë‹¤.\nê°€ì¡± êµ¬ì„±ì›ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    document.body.innerHTML = '<div style="text-align:center; margin-top:20%; font-size:18px; color:#666;">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    throw new Error('Authentication failed');
                }
            }
        })();
    </script>
</head>
<body>
    <!-- PWA ìƒíƒœë°” -->
    <div class="status-bar">
        <div class="status-text" id="status-text">ğŸ“± ê°€ì¡± ì‹œê°„í‘œ ë¡œë”© ì¤‘...</div>
        <button class="refresh-btn" onclick="refreshSchedule()">ğŸ”„</button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ìš°ë¦¬ ê°€ì¡± ì‹œê°„í‘œ</h1>
            <div class="week-info" id="week-info">
                <div class="current-week" id="current-week">2025ë…„ 9ì›” 1ì¼ ~ 9ì›” 7ì¼</div>
                <div class="week-navigation">
                    <button class="week-nav-btn" id="prev-week" onclick="changeWeek(-1)">â—€ ì´ì „ ì£¼</button>
                    <button class="week-nav-btn" id="next-week" onclick="changeWeek(1)">ë‹¤ìŒ ì£¼ â–¶</button>
                </div>
            </div>
        </div>
        
        <!-- ì£¼ê°„ ë©”ëª¨ & ì¤€ë¹„ì‚¬í•­ -->
        <div class="memo-guide" id="memo-guide">
            <h3>ğŸ“ ì£¼ê°„ ë©”ëª¨ & ì¤€ë¹„ì‚¬í•­</h3>
            <div id="memo-content">ë¡œë”© ì¤‘...</div>
        </div>
            
        <!-- ê°€ì¡± êµ¬ì„±ì› ìƒ‰ìƒ ë²”ë¡€ -->
        <div class="legend">
            <div class="legend-item">
                    <div class="color-box dad-bar"></div>
                <span>ğŸ‘¨â€ğŸ’¼ ì•„ë¹ </span>
                </div>
            <div class="legend-item">
                    <div class="color-box mom-bar"></div>
                <span>ğŸ‘©â€ğŸ’¼ ì—„ë§ˆ</span>
                </div>
            <div class="legend-item">
                    <div class="color-box child1-bar"></div>
                <span>ğŸ‘¦ ìœ¤ë¹ˆ</span>
                </div>
            <div class="legend-item">
                    <div class="color-box child2-bar"></div>
                <span>ğŸ‘§ ìœ¤ì¤€</span>
                </div>
            <div class="legend-item">
                <div class="color-box" style="background: linear-gradient(135deg, #FF9800, #F57C00); border: 2px solid #FF5722;"></div>
                <span>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ê³µí†µ</span>
            </div>
        </div>
        
        <!-- ì‹œê°„í‘œ -->
        <div class="timetable" id="timetable">
            <!-- ì‹œê°„í‘œ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
        
        <div class="export-info">
            <strong>ğŸ“± 4ë“±ë¶„ ê³ ì • ë ˆì´ì•„ì›ƒ ì‹œê°„í‘œ</strong><br>
            â€¢ ê° ê°€ì¡± êµ¬ì„±ì›ì€ í•­ìƒ ê°™ì€ ìœ„ì¹˜(ì¹¸)ì— ë°°ì¹˜<br>
            â€¢ 30ë¶„ ë‹¨ìœ„ ì •í™•í•œ ì‹œê°„ ê´€ë¦¬<br>
            â€¢ ì—°ì†ì„±ì´ ìœ ì§€ë˜ì–´ ë”ìš± ë³´ê¸° ì‰¬ì›€<br>
            â€¢ Google Sheetsì™€ ì‹¤ì‹œê°„ ë™ê¸°í™”<br>
            <strong>ì—…ë°ì´íŠ¸: <span id="update-time">ë¡œë”© ì¤‘...</span></strong>
                        </div>
                        </div>

    <script>
        // Google Sheets API ì„¤ì •
        const GOOGLE_SHEETS_API_KEY = 'AIzaSyB1hBonIutQtlTPjOFJe-jD94jq0hETn0A';
        const SPREADSHEET_ID = '12PFdelBBPZzNbGW654fSf8-RG8fcRBNLKTpeyjG28Nc';
        const RANGE = 'ì‹œíŠ¸1!A:M'; // 13ê°œ ì»¬ëŸ¼ (Date í•„ë“œ í¬í•¨)

        // í˜„ì¬ ì£¼ ì„¤ì • (ì£¼ê°„ ì´ë™ ê¸°ëŠ¥) - ì²« ë²ˆì§¸ ë°˜ë³µ ì¼ì • ì£¼ê°„ìœ¼ë¡œ ì´ˆê¸°í™”
        let currentWeek = new Date('2025-09-01'); // ì²« ë²ˆì§¸ ë°˜ë³µì¼(9ì›” 2ì¼) í¬í•¨ ì£¼ê°„
        console.log('ğŸš€ ì´ˆê¸° currentWeek ì„¤ì • (ì²« ë²ˆì§¸ ë°˜ë³µ ì¼ì • ì£¼ê°„):', currentWeek.toDateString());
        
        // ê°€ì¡± êµ¬ì„±ì› ì„¤ì •
        const familyMembers = ['ì•„ë¹ ', 'ì—„ë§ˆ', 'ìœ¤ë¹ˆ', 'ìœ¤ì¤€'];
        const memberColors = {
            'ì•„ë¹ ': 'dad-bar',
            'ì—„ë§ˆ': 'mom-bar',
            'ìœ¤ë¹ˆ': 'child1-bar',
            'ìœ¤ì¤€': 'child2-bar',
            'ê°€ì¡±ê³µí†µ': 'family-common'
        };

        const memberIcons = {
            'ì•„ë¹ ': 'ğŸ‘¨â€ğŸ’¼',
            'ì—„ë§ˆ': 'ğŸ‘©â€ğŸ’¼',
            'ìœ¤ë¹ˆ': 'ğŸ‘¦',
            'ìœ¤ì¤€': 'ğŸ‘§',
            'ê°€ì¡±ê³µí†µ': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦'
        };

        // ì‹œê°„ ìŠ¬ë¡¯ ìƒì„± (6:00-21:30, 30ë¶„ ë‹¨ìœ„)
        function generateTimeSlots() {
            const timeSlots = [];
            for (let hour = 6; hour <= 21; hour++) {
                timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
                if (hour < 21) {
                    timeSlots.push(`${hour.toString().padStart(2, '0')}:30`);
                }
            }
            timeSlots.push('21:30');
            return timeSlots;
        }

        // ì‹œê°„ì„ ìŠ¬ë¡¯ ë²ˆí˜¸ë¡œ ë³€í™˜
        function timeToSlot(timeStr) {
            if (!timeStr || timeStr === 'nan') return null;
            
            try {
                // ì‹œê°„ í˜•ì‹ ì •ê·œí™” (7:30 -> 07:30)
                let normalizedTime = timeStr;
                if (timeStr.match(/^\d{1,2}:\d{2}$/)) {
                    const [hours, minutes] = timeStr.split(':');
                    normalizedTime = `${hours.padStart(2, '0')}:${minutes}`;
                }
                
                const [hour, minute] = normalizedTime.split(':').map(Number);
                return (hour - 6) * 2 + (minute >= 30 ? 1 : 0);
            } catch {
                return null;
            }
        }

        // ì£¼ê°„ ì´ë™ í•¨ìˆ˜ (ì•ˆì „í•œ DOM ì¡°ì‘)
        function changeWeek(direction) {
            try {
                console.log('ğŸ”„ ì£¼ê°„ ì´ë™ ì‹œë„:', direction > 0 ? 'ë‹¤ìŒ ì£¼' : 'ì´ì „ ì£¼');
                
                // ìƒˆë¡œìš´ Date ê°ì²´ ìƒì„± (ì›ë³¸ ë³€ê²½ ë°©ì§€)
                const newWeek = new Date(currentWeek);
                newWeek.setDate(newWeek.getDate() + (direction * 7));
                currentWeek = newWeek;
                
                console.log('âœ… currentWeek ì—…ë°ì´íŠ¸ë¨:', currentWeek.toDateString());
                
                // ì£¼ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                updateWeekDisplay();
                
                // ì‹œê°„í‘œ ìƒˆë¡œê³ ì¹¨
                if (typeof updateTimetable === 'function') {
                    updateTimetable();
                    console.log('âœ… ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ updateTimetable í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
            } catch (error) {
                console.error('âŒ changeWeek ì˜¤ë¥˜:', error);
            }
        }
        
        // ì£¼ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì•ˆì „í•œ DOM ì¡°ì‘)
        function updateWeekDisplay() {
            try {
                const startOfWeek = new Date(currentWeek);
                const endOfWeek = new Date(currentWeek);
                endOfWeek.setDate(startOfWeek.getDate() + 6);
                
                const weekText = `${startOfWeek.getFullYear()}ë…„ ${startOfWeek.getMonth() + 1}ì›” ${startOfWeek.getDate()}ì¼ ~ ${endOfWeek.getMonth() + 1}ì›” ${endOfWeek.getDate()}ì¼`;
                
                console.log('ğŸ”„ ì£¼ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸:', weekText);
                
                // current-week ìš”ì†Œ ì—…ë°ì´íŠ¸
                const currentWeekElement = document.getElementById('current-week');
                if (currentWeekElement) {
                    currentWeekElement.textContent = weekText;
                    console.log('âœ… current-week ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ current-week ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                // ì´ì „/ë‹¤ìŒ ì£¼ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                const today = new Date();
                const todayWeek = new Date(today);
                todayWeek.setDate(today.getDate() - today.getDay() + 1);
                
                const weeksDiff = Math.floor((currentWeek - todayWeek) / (7 * 24 * 60 * 60 * 1000));
                
                const prevWeekBtn = document.getElementById('prev-week');
                const nextWeekBtn = document.getElementById('next-week');
                
                if (prevWeekBtn) {
                    prevWeekBtn.disabled = weeksDiff <= -4; // 4ì£¼ ì´ì „ê¹Œì§€ë§Œ
                    console.log('âœ… prev-week ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ prev-week ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                if (nextWeekBtn) {
                    nextWeekBtn.disabled = weeksDiff >= 4;  // 4ì£¼ ì´í›„ê¹Œì§€ë§Œ
                    console.log('âœ… next-week ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ next-week ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                // ì£¼ê°„ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ë“¤ì„ ë³´ì´ê²Œ ë§Œë“¤ê¸°
                const weekNavigation = document.querySelector('.week-navigation');
                if (weekNavigation) {
                    weekNavigation.style.display = 'flex';
                    console.log('âœ… ì£¼ê°„ ë„¤ë¹„ê²Œì´ì…˜ í‘œì‹œë¨');
                } else {
                    console.warn('âš ï¸ week-navigation ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
            } catch (error) {
                console.error('âŒ updateWeekDisplay ì˜¤ë¥˜:', error);
            }
        }
        
        // í…ìŠ¤íŠ¸ë¥¼ ì—¬ëŸ¬ ì¹¸ì— ë‚˜ëˆ„ì–´ í‘œì‹œ
        function splitTextForSlots(text, slotCount) {
            if (slotCount <= 1) return [text];
            
            const words = text.split(' ');
            
            if (words.length === 1) {
                const chars = text.split('');
                if (chars.length <= slotCount) {
                    return chars.concat(Array(slotCount - chars.length).fill(''));
                } else {
                    const charsPerSlot = Math.floor(chars.length / slotCount);
                    const remainder = chars.length % slotCount;
                    const result = [];
                    let start = 0;
                    
                    for (let i = 0; i < slotCount; i++) {
                        const end = start + charsPerSlot + (i < remainder ? 1 : 0);
                        result.push(chars.slice(start, end).join(''));
                        start = end;
                    }
                    return result;
                }
            } else if (words.length <= slotCount) {
                const result = [];
                for (let i = 0; i < slotCount; i++) {
                    result.push(i < words.length ? words[i] : '');
                }
                return result;
            } else {
                const wordsPerSlot = Math.floor(words.length / slotCount);
                const remainder = words.length % slotCount;
                const result = [];
                let start = 0;
                
                for (let i = 0; i < slotCount; i++) {
                    const end = start + wordsPerSlot + (i < remainder ? 1 : 0);
                    result.push(words.slice(start, end).join(' '));
                    start = end;
                }
                return result;
            }
        }

        // Google Sheetsì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (API v4 ì‚¬ìš©)
        async function fetchScheduleData() {
            try {
                const statusText = document.getElementById('status-text');
                statusText.textContent = 'ğŸ“¡ Google Sheets ë°ì´í„° ìš”ì²­ ì¤‘...';
                statusText.className = 'status-text status-warning';

                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${GOOGLE_SHEETS_API_KEY}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.values || data.values.length === 0) {
                    throw new Error('ì‹œíŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
                }
                
                // í—¤ë” ì œê±°í•˜ê³  ë°ì´í„°ë§Œ ì‚¬ìš©
                const scheduleData = data.values.slice(1);
                
                statusText.textContent = `âœ… Google Sheets ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${scheduleData.length}ê°œ ì¼ì •`;
                statusText.className = 'status-text status-success';
                
                return scheduleData;
            } catch (error) {
                console.error('Google Sheets ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                const statusText = document.getElementById('status-text');
                statusText.textContent = `âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
                statusText.className = 'status-text status-error';
                return [];
            }
        }

        // ì¼ì • ë°ì´í„°ë¥¼ ì‹œê°„í‘œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function processScheduleData(scheduleData) {
            const schedule = {};
            const memberMemos = { 'ì•„ë¹ ': {}, 'ì—„ë§ˆ': {}, 'ìœ¤ë¹ˆ': {}, 'ìœ¤ì¤€': {}, 'ê°€ì¡±ê³µí†µ': {} };
            
            // ğŸš¨ ë°˜ë³µ ì¼ì • ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ Set
            const processedRepeatingEvents = new Set();
            
            // ì˜ì–´ ìš”ì¼ì„ í•œêµ­ì–´ ìš”ì¼ë¡œ ë³€í™˜
            const dayMapping = {
                'monday': 'ì›”ìš”ì¼',
                'tuesday': 'í™”ìš”ì¼', 
                'wednesday': 'ìˆ˜ìš”ì¼',
                'thursday': 'ëª©ìš”ì¼',
                'friday': 'ê¸ˆìš”ì¼',
                'saturday': 'í† ìš”ì¼',
                'sunday': 'ì¼ìš”ì¼'
            };
            
            scheduleData.forEach(row => {
                try {
                    if (row.length < 13) return; // 13ê°œ ì»¬ëŸ¼ (Date í•„ë“œ í¬í•¨)
                    
                    const [id, title, member, participants, dayFromSheet, date, startTime, endTime, category, priority, repeat, memo, created] = row;
                    
                    console.log(`ğŸ” ì²˜ë¦¬ ì¤‘: ${title} (${member}) - ${dayFromSheet} ${startTime}-${endTime} - Date: ${date} - ë©”ëª¨: "${memo}"`);
                    
                    if (!title || !dayFromSheet || !startTime || !endTime) {
                        console.log(`âŒ í•„ìˆ˜ ë°ì´í„° ëˆ„ë½: ${title}`);
                        return;
                    }
                    
                    // ğŸš€ ë°˜ë³µ ì¼ì •ê³¼ ë‹¨ì¼ ì¼ì •ì„ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬
                    // 1. ë°˜ë³µ ì¼ì •: Day í•„ë“œ(ìš”ì¼)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í˜„ì¬ ì£¼ì— í•´ë‹¹ ìš”ì¼ì´ ìˆëŠ”ì§€ í™•ì¸
                    // 2. ë‹¨ì¼ ì¼ì •: Date í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í˜„ì¬ ì£¼ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
                    
                    const koreanDay = dayMapping[dayFromSheet.toLowerCase()];
                    if (!koreanDay) {
                        console.log(`âŒ ìš”ì¼ ë³€í™˜ ì‹¤íŒ¨: ${dayFromSheet}`);
                        return;
                    }
                    
                    // ë°˜ë³µ ì¼ì •ì¸ì§€ í™•ì¸ (Repeat í•„ë“œê°€ 'ì—†ìŒ'ì´ ì•„ë‹ˆê³ , ì‹¤ì œ ë°˜ë³µ ì„¤ì •ì´ ìˆëŠ” ê²½ìš°ë§Œ)
                    const isRepeatingEvent = repeat && repeat !== 'nan' && repeat.trim() !== '' && repeat.trim() !== 'ì—†ìŒ';
                    
                    if (isRepeatingEvent) {
                        // ğŸ”„ ë°˜ë³µ ì¼ì •: ìš”ì¼ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬ + ë‚ ì§œ ë²”ìœ„ ì²´í¬
                        console.log(`ğŸ”„ ë°˜ë³µ ì¼ì • ì²˜ë¦¬: ${title} (${koreanDay}) - Date: ${date}`);
                        
                        // ğŸš¨ ë°˜ë³µ ì¼ì • ì¤‘ë³µ ë°©ì§€: ID ê¸°ì¤€ìœ¼ë¡œ ì²˜ë¦¬ (ê° ë°˜ë³µ ì¼ì •ì€ ê³ ìœ  ID ë³´ìœ )
                        const eventKey = `${id}`; // IDë§Œìœ¼ë¡œ ì¤‘ë³µ ì²´í¬ (ê° ë°˜ë³µ ì¼ì •ì€ ê³ ìœ  ID)
                        if (processedRepeatingEvents.has(eventKey)) {
                            console.log(`â­ï¸ ë°˜ë³µ ì¼ì • ì¤‘ë³µ ê±´ë„ˆë›°ê¸°: ${title} (${koreanDay}) - ID: ${id}`);
                            return;
                        }
                        processedRepeatingEvents.add(eventKey);
                        
                        // 1ï¸âƒ£ Date í•„ë“œê°€ ìˆìœ¼ë©´ í•´ë‹¹ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì²´í¬ (ì´ë¯¸ ê³„ì‚°ëœ ë°˜ë³µ ì¼ì •)
                        if (date && date !== 'nan' && date.toString().trim() !== '') {
                            try {
                                const eventDate = new Date(date);
                                const currentWeekStart = new Date(currentWeek);
                                const currentWeekEnd = new Date(currentWeek);
                                currentWeekEnd.setDate(currentWeekStart.getDate() + 6);
                                
                                // ğŸš¨ ë°˜ë³µ ì¼ì • ìœ íš¨ ë²”ìœ„ ì²´í¬ (ì²« ë²ˆì§¸ ì˜¬ë°”ë¥¸ ë°˜ë³µì¼ ê¸°ì¤€)
                                // ì‹œì‘ì¼(8ì›” 27ì¼, ìˆ˜ìš”ì¼) ì´í›„ ì²« ë²ˆì§¸ í™”ìš”ì¼ = 9ì›” 2ì¼
                                const validRepeatStartDate = new Date('2025-09-02'); // ì²« ë²ˆì§¸ ì˜¬ë°”ë¥¸ ë°˜ë³µì¼
                                const validRepeatEndDate = new Date('2025-11-20');
                                
                                if (eventDate < validRepeatStartDate) {
                                    console.log(`âŒ ë°˜ë³µ ì¼ì •(ë‚ ì§œ ê¸°ì¤€) ì œì™¸: ${title} (${date}) - ìœ íš¨ ë°˜ë³µ ë²”ìœ„ ì´ì „ (${validRepeatStartDate.toDateString()} ì´ì „)`);
                                    return;
                                } else if (eventDate > validRepeatEndDate) {
                                    console.log(`âŒ ë°˜ë³µ ì¼ì •(ë‚ ì§œ ê¸°ì¤€) ì œì™¸: ${title} (${date}) - ìœ íš¨ ë°˜ë³µ ë²”ìœ„ ì´í›„ (${validRepeatEndDate.toDateString()} ì´í›„)`);
                                    return;
                                }
                                
                                // í˜„ì¬ ì£¼ ë²”ìœ„ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ì¼ì •ì€ ì œì™¸
                                if (eventDate < currentWeekStart || eventDate > currentWeekEnd) {
                                    console.log(`âŒ ë°˜ë³µ ì¼ì •(ë‚ ì§œ ê¸°ì¤€) ì œì™¸: ${title} (${date}) - í˜„ì¬ ì£¼: ${currentWeekStart.toDateString()} ~ ${currentWeekEnd.toDateString()}`);
                                    return;
                                } else {
                                    console.log(`âœ… ë°˜ë³µ ì¼ì •(ë‚ ì§œ ê¸°ì¤€) í¬í•¨: ${title} (${date}) - í˜„ì¬ ì£¼: ${currentWeekStart.toDateString()} ~ ${currentWeekEnd.toDateString()}`);
                                }
                            } catch (error) {
                                console.warn(`âš ï¸ ë°˜ë³µ ì¼ì • ë‚ ì§œ íŒŒì‹± ì‹¤íŒ¨: ${date}`, error);
                                return;
                            }
                        } else {
                            // 2ï¸âƒ£ Date í•„ë“œê°€ ì—†ìœ¼ë©´ ìš”ì¼ ê¸°ì¤€ + ë°˜ë³µ ë²”ìœ„ ì²´í¬
                            const currentWeekStart = new Date(currentWeek);
                            const currentWeekEnd = new Date(currentWeek);
                            currentWeekEnd.setDate(currentWeekStart.getDate() + 6);
                            
                            // ìš”ì¼ì„ ìˆ«ìë¡œ ë³€í™˜ (0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼)
                            const dayNumbers = { 'ì›”ìš”ì¼': 1, 'í™”ìš”ì¼': 2, 'ìˆ˜ìš”ì¼': 3, 'ëª©ìš”ì¼': 4, 'ê¸ˆìš”ì¼': 5, 'í† ìš”ì¼': 6, 'ì¼ìš”ì¼': 0 };
                            const eventDayNumber = dayNumbers[koreanDay];
                            
                            if (eventDayNumber !== undefined) {
                                // í˜„ì¬ ì£¼ì˜ í•´ë‹¹ ìš”ì¼ ë‚ ì§œ ê³„ì‚°
                                const currentDay = new Date(currentWeek);
                                currentDay.setDate(currentWeek.getDate() + eventDayNumber - 1);
                                
                                // ë°˜ë³µ ì¼ì • ë²”ìœ„ ì„¤ì • (Managerì™€ ë™ì¼í•œ ë²”ìœ„)
                                const repeatStartDate = new Date('2025-09-02'); // ì²« ë²ˆì§¸ ì˜¬ë°”ë¥¸ ë°˜ë³µì¼
                                const repeatEndDate = new Date('2025-11-20');
                                
                                // í˜„ì¬ ì£¼ì˜ í•´ë‹¹ ìš”ì¼ì´ ë°˜ë³µ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ ì²´í¬
                                if (currentDay >= repeatStartDate && currentDay <= repeatEndDate && 
                                    currentDay >= currentWeekStart && currentDay <= currentWeekEnd) {
                                    console.log(`âœ… ë°˜ë³µ ì¼ì •(ìš”ì¼ ê¸°ì¤€) í¬í•¨: ${title} (${koreanDay}) - ${currentDay.toDateString()} - ë°˜ë³µ ë²”ìœ„ ë‚´`);
                                } else {
                                    if (currentDay < repeatStartDate || currentDay > repeatEndDate) {
                                        console.log(`âŒ ë°˜ë³µ ì¼ì •(ìš”ì¼ ê¸°ì¤€) ì œì™¸: ${title} (${koreanDay}) - ${currentDay.toDateString()} - ë°˜ë³µ ë²”ìœ„ ë°– (${repeatStartDate.toDateString()} ~ ${repeatEndDate.toDateString()})`);
                                    } else {
                                        console.log(`âŒ ë°˜ë³µ ì¼ì •(ìš”ì¼ ê¸°ì¤€) ì œì™¸: ${title} (${koreanDay}) - ${currentDay.toDateString()} - í˜„ì¬ ì£¼ ë²”ìœ„ ë°–`);
                                    }
                                    return;
                                }
                            }
                        }
                    } else {
                        // ğŸ“… ë‹¨ì¼ ì¼ì •: Date í•„ë“œ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬
                        if (date && date !== 'nan' && date.toString().trim() !== '') {
                            try {
                                const eventDate = new Date(date);
                                const currentWeekStart = new Date(currentWeek);
                                const currentWeekEnd = new Date(currentWeek);
                                currentWeekEnd.setDate(currentWeekStart.getDate() + 6);
                                
                                // í˜„ì¬ ì£¼ ë²”ìœ„ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ì¼ì •ì€ ì œì™¸
                                if (eventDate < currentWeekStart || eventDate > currentWeekEnd) {
                                    console.log(`âŒ ë‹¨ì¼ ì¼ì • ì œì™¸: ${title} (${date}) - í˜„ì¬ ì£¼: ${currentWeekStart.toDateString()} ~ ${currentWeekEnd.toDateString()}`);
                                    return;
                                } else {
                                    console.log(`âœ… ë‹¨ì¼ ì¼ì • í¬í•¨: ${title} (${date}) - í˜„ì¬ ì£¼: ${currentWeekStart.toDateString()} ~ ${currentWeekEnd.toDateString()}`);
                                }
                    } catch (error) {
                                console.warn(`âš ï¸ ë‚ ì§œ íŒŒì‹± ì‹¤íŒ¨: ${date}`, error);
                                return;
                            }
                        } else {
                            console.log(`âš ï¸ ë‹¨ì¼ ì¼ì •ì¸ë° Date í•„ë“œ ì—†ìŒ: ${title}`);
                            return;
                        }
                    }
                    
                    console.log(`âœ… ì¼ì • í¬í•¨: ${title} (${koreanDay}) - Date: ${date}`);
                    
                    // ì˜ì–´ ìš”ì¼ì„ í•œêµ­ì–´ë¡œ ë³€í™˜ (ì´ë¯¸ ìœ„ì—ì„œ ì²˜ë¦¬ë¨)
                    
                    console.log(`âœ… ì¼ì • í¬í•¨: ${title} (${koreanDay}) - Date: ${date}`);
                    
                    const startSlot = timeToSlot(startTime);
                    const endSlot = timeToSlot(endTime);
                    
                    if (startSlot === null || endSlot === null) {
                        console.log(`âŒ ì‹œê°„ ìŠ¬ë¡¯ ë³€í™˜ ì‹¤íŒ¨: ${startTime} -> ${startSlot}, ${endTime} -> ${endSlot}`);
                        return;
                    }
                    
                    console.log(`âœ… ìŠ¬ë¡¯ ë³€í™˜ ì„±ê³µ: ${startTime}(${startSlot}) - ${endTime}(${endSlot})`);
                    
                    // ë©”ëª¨ ìˆ˜ì§‘ (ë¹ˆ ë¬¸ìì—´ë„ ì²˜ë¦¬)
                    if (memo && memo !== 'nan' && memo.trim() !== '') {
                        console.log(`ğŸ“ ë©”ëª¨ ë°œê²¬: ${member} - ${koreanDay} - "${memo}"`);
                        
                        // ê°€ì¡±ê³µí†µ ë©”ëª¨ëŠ” ê°€ì¡±ê³µí†µì—ê²Œë§Œ ì¶”ê°€
                        if (member === 'ê°€ì¡±ê³µí†µ') {
                            if (!memberMemos['ê°€ì¡±ê³µí†µ'][koreanDay]) {
                                memberMemos['ê°€ì¡±ê³µí†µ'][koreanDay] = [];
                            }
                            memberMemos['ê°€ì¡±ê³µí†µ'][koreanDay].push(memo);
                            console.log(`ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ê³µí†µ ë©”ëª¨ ì¶”ê°€: ê°€ì¡±ê³µí†µ - ${koreanDay}`);
                        } else if (member in memberMemos) {
                            if (!memberMemos[member][koreanDay]) {
                                memberMemos[member][koreanDay] = [];
                            }
                            memberMemos[member][koreanDay].push(memo);
                            console.log(`âœ… ê°œì¸ ë©”ëª¨ ì¶”ê°€: ${member} - ${koreanDay} - "${memo}"`);
                        }
                    } else {
                        console.log(`ğŸ“ ë©”ëª¨ ì—†ìŒ: ${member} - ${koreanDay}`);
                    }
                    
                    // ì°¸ì„ì ì •ë³´ ì²˜ë¦¬
                    let mainPerson = member;
                    let membersToAdd = [member];
                    
                    if (member === 'ê°€ì¡±ê³µí†µ') {
                        mainPerson = 'ê°€ì¡±ê³µí†µ';
                        membersToAdd = familyMembers;
                    } else if (participants && participants !== 'nan') {
                        const participantList = participants.split(',').map(p => p.trim());
                        if (participantList.length > 1) {
                            membersToAdd = participantList;
                        }
                    }
                    
                    const duration = endSlot - startSlot;
                    const splitTexts = splitTextForSlots(title, duration);
                    
                    membersToAdd.forEach(memberName => {
                        if (familyMembers.includes(memberName) || memberName === 'ê°€ì¡±ê³µí†µ') {
                            for (let slot = startSlot; slot < endSlot; slot++) {
                                if (slot < 0) continue;
                                
                                if (!schedule[koreanDay]) schedule[koreanDay] = {};
                                if (!schedule[koreanDay][slot]) schedule[koreanDay][slot] = {};
                                
                                const barType = slot === startSlot && slot === endSlot - 1 ? 'single' :
                                              slot === startSlot ? 'start' :
                                              slot === endSlot - 1 ? 'end' : 'middle';
                                
                                const slotPosition = slot - startSlot;
                                const slotText = splitTexts[slotPosition] || '';
                                
                                schedule[koreanDay][slot][memberName] = {
                                    title: title,
                                    slotText: slotText,
                                    person: member,
                                    mainPerson: mainPerson,
                                    participants: participants,
                                    class: getEventColorClass(mainPerson, participants),
                                    barType: barType,
                                    duration: duration,
                                    isFamily: member === 'ê°€ì¡±ê³µí†µ',
                                    isMulti: participants && participants !== 'nan' && participants.split(',').length > 1
                                };
                            }
                        }
                    });
                } catch (error) {
                    console.error('ì¼ì • ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                }
            });
            
            return { schedule, memberMemos };
        }

        // ì¼ì • ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
        function getEventColorClass(mainPerson, participants) {
            if (mainPerson === 'ê°€ì¡±ê³µí†µ') {
                return 'family-common';
            } else if (participants && participants !== 'nan' && participants.split(',').length > 1) {
                return 'multi-participant';
                    } else {
                return memberColors[mainPerson] || 'dad-bar';
            }
        }

        // ì‹œê°„í‘œ HTML ìƒì„±
        function generateTimetableHTML(schedule, memberMemos) {
            const timeSlots = generateTimeSlots();
            const days = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
            const dayAbbr = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
            
            // í—¤ë” ìƒì„± (currentWeek ì‚¬ìš©)
            const monday = new Date(currentWeek);
            
            let headerRow = '<tr><th class="time-col">ì‹œê°„</th>';
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                headerRow += `<th>${days[i]}<br><small>${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}</small></th>`;
            }
            headerRow += '</tr>';
            
            // ì‹œê°„í‘œ í–‰ ìƒì„±
            let tableRows = '';
            timeSlots.forEach((timeStr, slotIdx) => {
                const isHour = timeStr.endsWith(':00');
                const hourClass = isHour ? 'hour-line' : '';
                const timeDisplay = isHour ? `<strong>${timeStr}</strong>` : timeStr;
                
                let rowHtml = `<tr><td class="time-col ${hourClass}">${timeDisplay}</td>`;
                
                for (let dayIdx = 0; dayIdx < 7; dayIdx++) {
                    const currentDay = days[dayIdx];
                    let cellContent = '<div class="time-slot">';
                    
                    // 4ê°œ ê³ ì • ì¹¸ ìƒì„±
                    familyMembers.forEach((member, i) => {
                        const leftPosition = `${i * 25}%`;
                        const width = "24%";
                        
                        const event = schedule[currentDay] && schedule[currentDay][slotIdx] && schedule[currentDay][slotIdx][member];
                        
                        if (event) {
                            const duration = event.duration;
                            const slotText = event.slotText;
                            
                            let textSpan = '';
                            if (slotText.trim()) {
                                textSpan = `<span class="event-text large-text" style="font-size: 13px;">${slotText}</span>`;
                            }
                            
                            let specialClass = '';
                            if (event.isFamily) {
                                specialClass = 'family-common';
                            } else if (event.isMulti) {
                                specialClass = 'multi-participant';
                            }
                            
                            cellContent += `
                            <div class="event-bar ${event.class} bar-${event.barType} ${specialClass}" 
                                 style="left: ${leftPosition}; width: ${width};"
                                 data-member="${member}"
                                 data-duration="${duration}">
                                ${textSpan}
                            </div>`;
                        } else {
                            cellContent += `
                            <div class="empty-slot" 
                                 style="left: ${leftPosition}; width: ${width};"
                                 data-member="${member}">
                            </div>`;
                        }
                    });
                    
                    cellContent += '</div>';
                    rowHtml += `<td>${cellContent}</td>`;
                }
                
                rowHtml += '</tr>';
                tableRows += rowHtml;
            });
            
            return { headerRow, tableRows };
        }

        // ì£¼ê°„ ë©”ëª¨ ìƒì„±
        function generateWeeklyMemo(memberMemos) {
            let memoHtml = '';
            
            // ê°€ì¡±ê³µí†µ ë©”ëª¨ ë¨¼ì € í‘œì‹œ
            if (memberMemos['ê°€ì¡±ê³µí†µ']) {
                const icon = 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦';
                const colorClass = 'family-common';
                
                const memoItems = [];
                const days = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
                
                days.forEach(day => {
                    if (memberMemos['ê°€ì¡±ê³µí†µ'][day] && memberMemos['ê°€ì¡±ê³µí†µ'][day].length > 0) {
                        const uniqueMemos = [...new Set(memberMemos['ê°€ì¡±ê³µí†µ'][day])];
                        let memoText = uniqueMemos[0].substring(0, 30);
                        
                        // ë‹¨ì–´ ë‹¨ìœ„ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìë¥´ê¸° (25ìì—ì„œ ë‹¨ì–´ ê²½ê³„)
                        if (memoText.length >= 25) {
                            const lastSpace = memoText.lastIndexOf(' ', 25);
                            if (lastSpace > 15) {
                                memoText = memoText.substring(0, lastSpace) + "..";
                            } else {
                                memoText = memoText.substring(0, 25) + "..";
                            }
                        }
                        
                        // ìš”ì¼ í‘œì‹œ ë‹¨ì¶•: "ëª©ìš”ì¼:" â†’ "ëª©:"
                        const shortDay = day.substring(0, 1);
                        memoItems.push(`${shortDay}: ${memoText}`);
                    }
                });
                
                const displayMemos = memoItems.slice(0, 4); // 3ê°œ â†’ 4ê°œë¡œ ì¦ê°€
                if (memoItems.length > 4) {
                    displayMemos.push(`ì™¸ ${memoItems.length - 4}ê°œ`);
                }
                
                // "â€¢ " êµ¬ë¶„ìë¡œ ë³€ê²½í•˜ê³  ì¤„ë°”ê¿ˆ ì¶”ê°€
                const memoText = displayMemos.length > 0 ? displayMemos.map(memo => `â€¢ ${memo}`).join("<br>") : "ğŸ“Œ íŠ¹ë³„ ì¤€ë¹„ì‚¬í•­ ì—†ìŒ";
                
                memoHtml += `
                <div class="member-memo">
                    <div class="memo-header">
                        <div class="color-box ${colorClass}"></div>
                        <span class="member-name">${icon} ê°€ì¡±ê³µí†µ</span>
                    </div>
                    <div class="memo-content">${memoText}</div>
                </div>`;
            }
            
            familyMembers.forEach(member => {
                const icon = memberIcons[member];
                const colorClass = memberColors[member];
                
                const memoItems = [];
                const days = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
                
                days.forEach(day => {
                    if (memberMemos[member][day] && memberMemos[member][day].length > 0) {
                        const uniqueMemos = [...new Set(memberMemos[member][day])];
                        const familyMemo = uniqueMemos.find(memo => memo.includes('[ê°€ì¡±]'));
                        
                        let memoText;
                        if (familyMemo) {
                            memoText = familyMemo.replace('[ê°€ì¡±] ', '').substring(0, 30);
                        } else {
                            memoText = uniqueMemos[0].substring(0, 30);
                        }
                        
                        // ë‹¨ì–´ ë‹¨ìœ„ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìë¥´ê¸° (25ìì—ì„œ ë‹¨ì–´ ê²½ê³„)
                        if (memoText.length >= 25) {
                            const lastSpace = memoText.lastIndexOf(' ', 25);
                            if (lastSpace > 15) {
                                memoText = memoText.substring(0, lastSpace) + "..";
                            } else {
                                memoText = memoText.substring(0, 25) + "..";
                            }
                        }
                        
                        // ìš”ì¼ í‘œì‹œ ë‹¨ì¶•: "ëª©ìš”ì¼:" â†’ "ëª©:"
                        const shortDay = day.substring(0, 1);
                        memoItems.push(`${shortDay}: ${memoText}`);
                    }
                });
                
                const displayMemos = memoItems.slice(0, 4); // 3ê°œ â†’ 4ê°œë¡œ ì¦ê°€
                if (memoItems.length > 4) {
                    displayMemos.push(`ì™¸ ${memoItems.length - 4}ê°œ`);
                }
                
                // "â€¢ " êµ¬ë¶„ìë¡œ ë³€ê²½í•˜ê³  ì¤„ë°”ê¿ˆ ì¶”ê°€
                const memoText = displayMemos.length > 0 ? displayMemos.map(memo => `â€¢ ${memo}`).join("<br>") : "ğŸ“Œ íŠ¹ë³„ ì¤€ë¹„ì‚¬í•­ ì—†ìŒ";
                
                memoHtml += `
                <div class="member-memo">
                    <div class="memo-header">
                        <div class="color-box ${colorClass}"></div>
                        <span class="member-name">${icon} ${member}</span>
                    </div>
                    <div class="memo-content">${memoText}</div>
                </div>`;
            });
            
            return memoHtml;
        }

        // ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ (ì•ˆì „í•œ DOM ì¡°ì‘)
        async function updateTimetable() {
            try {
                console.log('ğŸ”„ ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ ì‹œì‘...');
                
                const scheduleData = await fetchScheduleData();
                if (scheduleData.length === 0) {
                    throw new Error('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                }
                
                console.log(`ğŸ“Š ${scheduleData.length}ê°œì˜ ì¼ì • ë°ì´í„° ë¡œë“œë¨`);
                
                const { schedule, memberMemos } = processScheduleData(scheduleData);
                console.log('âœ… ì¼ì • ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ');
                
                const { headerRow, tableRows } = generateTimetableHTML(schedule, memberMemos);
                const memoHtml = generateWeeklyMemo(memberMemos);
                
                // DOM ì—…ë°ì´íŠ¸ (ì•ˆì „í•œ ì¡°ì‘)
                const timetableElement = document.getElementById('timetable');
                if (timetableElement) {
                    timetableElement.innerHTML = `
                        <table>
                            <thead>${headerRow}</thead>
                            <tbody>${tableRows}</tbody>
                        </table>
                    `;
                    console.log('âœ… ì‹œê°„í‘œ DOM ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ timetable ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                const memoContentElement = document.getElementById('memo-content');
                if (memoContentElement) {
                    memoContentElement.innerHTML = memoHtml;
                    console.log('âœ… ë©”ëª¨ DOM ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ memo-content ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                // ì£¼ê°„ ì •ë³´ ì—…ë°ì´íŠ¸ (currentWeek ì‚¬ìš©)
                updateWeekDisplay();
                
                // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
                const updateTimeElement = document.getElementById('update-time');
                if (updateTimeElement) {
                    const today = new Date();
                    updateTimeElement.textContent = today.toLocaleString('ko-KR', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    console.log('âœ… ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ update-time ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                const statusText = document.getElementById('status-text');
                if (statusText) {
                    statusText.textContent = 'âœ… ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ ì™„ë£Œ';
                    statusText.className = 'status-text status-success';
                    
                    setTimeout(() => {
                        statusText.textContent = 'ğŸ“± ê°€ì¡± ì‹œê°„í‘œ';
                        statusText.className = 'status-text';
                    }, 2000);
                    console.log('âœ… ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ status-text ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                console.log('ğŸ‰ ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ ì™„ë£Œ!');
                
            } catch (error) {
                console.error('âŒ ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                const statusText = document.getElementById('status-text');
                if (statusText) {
                    statusText.textContent = `âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                    statusText.className = 'status-text status-error';
                }
            }
        }

        // ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        function refreshSchedule() {
            const statusText = document.getElementById('status-text');
            statusText.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨ ì¤‘...';
            statusText.className = 'status-text status-warning';
            
            setTimeout(() => {
                updateTimetable();
            }, 500);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œê°„í‘œ ìƒì„±
        window.addEventListener('load', () => {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œë¨ - ì´ˆê¸°í™” ì‹œì‘');
            
            // PWA Service Worker ë“±ë¡
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('âœ… PWA Service Worker ë“±ë¡ ì™„ë£Œ:', registration.scope);
                    })
                    .catch(error => {
                        console.log('âŒ PWA Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            }
            
            // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.log('ğŸ“± PWA ì„¤ì¹˜ ê°€ëŠ¥!');
                
                // ì„¤ì¹˜ ì•Œë¦¼ í‘œì‹œ
                showInstallNotification();
            });
            
            // ì£¼ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
            if (typeof updateWeekDisplay === 'function') {
                updateWeekDisplay();
                console.log('âœ… ì´ˆê¸° ì£¼ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            } else {
                console.warn('âš ï¸ updateWeekDisplay í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ì‹œê°„í‘œ ì—…ë°ì´íŠ¸
            if (typeof updateTimetable === 'function') {
                updateTimetable();
                console.log('âœ… ì´ˆê¸° ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ ì‹œì‘');
            } else {
                console.warn('âš ï¸ updateTimetable í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
        });

        // PWA ì„¤ì¹˜ ì•Œë¦¼ í‘œì‹œ
        function showInstallNotification() {
            // ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('âœ… PWA ì´ë¯¸ ì„¤ì¹˜ë¨');
                return;
            }
            
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="
                    position: fixed; 
                    bottom: 20px; 
                    left: 20px; 
                    right: 20px; 
                    background: #6366f1; 
                    color: white; 
                    padding: 15px; 
                    border-radius: 10px; 
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 2000;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    max-width: 400px;
                    margin: 0 auto;
                    animation: slideUp 0.3s ease;
                ">
                    <div>
                        <div style="font-weight: bold; margin-bottom: 4px;">ğŸ“± ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°</div>
                        <div style="font-size: 14px; opacity: 0.9;">í™ˆ í™”ë©´ì— ì¶”ê°€í•´ì„œ ë¹ ë¥´ê²Œ ì ‘ê·¼í•˜ì„¸ìš”!</div>
                    </div>
                    <button id="install-btn" style="
                        background: rgba(255,255,255,0.2); 
                        border: 1px solid rgba(255,255,255,0.3); 
                        color: white; 
                        padding: 8px 16px; 
                        border-radius: 6px; 
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: bold;
                    ">ì„¤ì¹˜</button>
                    <button id="dismiss-btn" style="
                        background: none; 
                        border: none; 
                        color: rgba(255,255,255,0.7); 
                        cursor: pointer; 
                        font-size: 18px;
                        margin-left: 10px;
                    ">Ã—</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // ì„¤ì¹˜ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('install-btn').addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('âœ… PWA ì„¤ì¹˜ ì™„ë£Œ');
                        }
                        deferredPrompt = null;
                    });
                }
                notification.remove();
            });
            
            // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('dismiss-btn').addEventListener('click', () => {
                notification.remove();
            });
            
            // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 8000);
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.refreshSchedule = refreshSchedule;
    </script>
</body>
</html>